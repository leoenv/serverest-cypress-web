"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.enableCucumberSupport = void 0;
const CUCUMBER_TASK_NAME = 'qaseCucumberStepStart';
const enableCucumberSupport = () => {
    registerCypressEventListeners();
};
exports.enableCucumberSupport = enableCucumberSupport;
const registerCypressEventListeners = () => {
    Cypress.on('log:added', handleLogAdded);
};
const handleLogAdded = (_, entry) => {
    if (isCucumberStep(entry)) {
        processCucumberStep(entry);
    }
};
const isCucumberStep = ({ attributes: { name, event, instrument } }) => {
    return instrument === 'command' && !event && name === 'step';
};
const processCucumberStep = ({ attributes: { displayName, message } }) => {
    sendTaskMessage(`${displayName ?? ''} ${message}`);
};
const sendTaskMessage = (message) => {
    cy.task(CUCUMBER_TASK_NAME, message, { log: false });
};
